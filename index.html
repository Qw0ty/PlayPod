<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ìŒì•… ì¶”ì²œ ì œë³´</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body{
  font-family:system-ui;
  background:linear-gradient(135deg,#0f0f1a,#1a1a2e);
  margin:0;padding:24px;
}
.card{
  max-width:760px;margin:auto;
  background:white;border-radius:18px;padding:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.3);
  animation:floatIn .7s ease;
}
@keyframes floatIn{
  from{opacity:0;transform:translateY(40px) scale(.95)}
  to{opacity:1;transform:translateY(0) scale(1)}
}
label{font-weight:800;margin-top:12px;display:block}
input,textarea{
  width:100%;padding:10px;border-radius:10px;
  border:1px solid #ccc;margin-top:6px;
}
input:focus,textarea:focus{
  outline:none;border-color:#6a5cff;
  box-shadow:0 0 0 3px rgba(106,92,255,.25);
}
button{
  margin-top:14px;padding:12px 16px;
  border-radius:12px;border:none;
  background:linear-gradient(135deg,#6a5cff,#8f7bff);
  color:white;font-weight:900;cursor:pointer;
  box-shadow:0 6px 14px rgba(0,0,0,.3);
  transition:.2s;
}
button:hover{transform:translateY(-2px)}
.row{display:flex;gap:12px}
.row>div{flex:1}
.preview{
  margin-top:14px;padding:12px;border-radius:12px;
  background:#fafafa;border:1px dashed #ddd;
  display:none;
}
.preview img{max-width:220px;border-radius:10px;margin-top:8px}
.status{margin-top:10px;font-weight:900}
</style>
</head>

<body>
<div class="card">
<h1>ğŸ§ ìŒì•… ì¶”ì²œ ì œë³´</h1>

<form id="form" action="https://formspree.io/f/mlggjprl" method="POST">

<label>ë‹‰ë„¤ì„</label>
<input name="nickname" placeholder="ì˜ˆ: PlayPod_K" required>

<label>ìŒì•… ë§í¬</label>
<input id="url" name="music_url" placeholder="YouTube / Spotify / SoundCloud" required>

<div class="row">
<div>
<label>ì‹œì‘ ì‹œê°„</label>
<input name="start_time" placeholder="1:12" required>
</div>
<div>
<label>ë ì‹œê°„</label>
<input name="end_time" placeholder="1:45" required>
</div>
</div>

<label>ë©”ëª¨</label>
<textarea name="note"></textarea>

<button type="button" id="previewBtn">ë¯¸ë¦¬ë³´ê¸°</button>
<button type="submit">ì „ì†¡í•˜ê¸°</button>

<div id="preview" class="preview"></div>
<div id="status" class="status"></div>

<input type="hidden" id="meta_title" name="meta_title">
<input type="hidden" id="meta_author" name="meta_author">
<input type="hidden" id="meta_provider" name="meta_provider">
<input type="hidden" id="meta_thumbnail" name="meta_thumbnail">

</form>
</div>

<script>
const $ = id => document.getElementById(id);

function detect(url){
  if(url.includes("youtu")) return "youtube";
  if(url.includes("spotify")) return "spotify";
  if(url.includes("soundcloud")) return "soundcloud";
  return null;
}

function oembed(type,url){
  const u=encodeURIComponent(url);
  if(type=="youtube") return `https://www.youtube.com/oembed?url=${u}&format=json`;
  if(type=="spotify") return `https://open.spotify.com/oembed?url=${u}`;
  if(type=="soundcloud") return `https://soundcloud.com/oembed?format=json&url=${u}`;
}

async function preview(){
  const url=$("url").value.trim();
  if(!url) return;

  const type=detect(url);
  if(!type){$("status").innerText="ì§€ì› ì•ˆë˜ëŠ” ë§í¬";return;}

  try{
    const res=await fetch(oembed(type,url));
    const data=await res.json();

    $("preview").style.display="block";
    $("preview").innerHTML=`
      <b>${data.title}</b><br>
      ${data.author_name || ""}<br>
      <img src="${data.thumbnail_url || ""}">
    `;

    $("meta_title").value=data.title;
    $("meta_author").value=data.author_name;
    $("meta_provider").value=data.provider_name;
    $("meta_thumbnail").value=data.thumbnail_url;

    $("status").innerText="ë¯¸ë¦¬ë³´ê¸° ì™„ë£Œ!";
  }catch{
    $("status").innerText="ë¯¸ë¦¬ë³´ê¸° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨ (ê·¸ë˜ë„ ì „ì†¡ ê°€ëŠ¥)";
  }
}

$("previewBtn").addEventListener("click",preview);

$("form").addEventListener("submit",()=>{
  setTimeout(()=>{
    confetti({particleCount:200,spread:100,origin:{y:0.6}});
    $("status").innerText="ì „ì†¡ ì™„ë£Œ! ğŸ‰ ì¶”ì²œ ê°ì‚¬í•©ë‹ˆë‹¤!";
  },300);
});
</script>
</body>
</html>

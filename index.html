<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ìŒì•… ì¶”ì²œ ì œë³´</title>

<!-- í­ì£½ -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
  :root{
    --accent:#6a5cff;
    --accent2:#8f7bff;
    --card:rgba(255,255,255,.92);
    --shadow:0 18px 40px rgba(0,0,0,.35);
  }

  /* ë°°ê²½ ë ˆì´ì–´ (í¬ë¡œìŠ¤í˜ì´ë“œìš©) */
  body{
    margin:0;
    font-family:system-ui,-apple-system,Arial,sans-serif;
    min-height:100vh;
    overflow-x:hidden;
  }
  .bg{
    position:fixed; inset:0;
    background-size:cover;
    background-position:center;
    filter:saturate(1.05) contrast(1.05);
    transform:scale(1.05);
    transition:opacity 900ms ease;
    opacity:0;
    z-index:-3;
  }
  .bg.on{opacity:1;}
  .overlay{
    position:fixed; inset:0;
    background:radial-gradient(1200px 600px at 20% 10%, rgba(106,92,255,.25), transparent 60%),
               linear-gradient(135deg, rgba(0,0,0,.55), rgba(0,0,0,.35));
    z-index:-2;
  }
  .grain{
    position:fixed; inset:0;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.12'/%3E%3C/svg%3E");
    mix-blend-mode:overlay;
    opacity:.25;
    z-index:-1;
    pointer-events:none;
  }

  .wrap{padding:22px;}
  .card{
    max-width:720px;
    margin:0 auto;
    background:var(--card);
    border-radius:16px;
    padding:16px 16px 14px;
    box-shadow:var(--shadow);
    backdrop-filter: blur(10px);
    animation:floatIn .6s ease;
  }
  @keyframes floatIn{
    from{opacity:0;transform:translateY(18px) scale(.98)}
    to{opacity:1;transform:translateY(0) scale(1)}
  }

  h1{margin:0 0 6px 0; font-size:22px;}
  .muted{color:rgba(0,0,0,.6); font-weight:600; margin:0 0 10px 0; font-size:13px;}

  label{display:block; margin-top:10px; font-weight:850; font-size:13px;}
  input,textarea{
    width:100%;
    box-sizing:border-box;
    margin-top:6px;
    padding:9px 10px;           /* âœ… í¬ê¸° ì¤„ì„ */
    border-radius:10px;
    border:1px solid rgba(0,0,0,.16);
    font-size:14px;
    background:rgba(255,255,255,.9);
    transition: box-shadow .18s ease, transform .18s ease, border-color .18s ease;
  }
  textarea{min-height:72px; resize:vertical;}

  input:focus, textarea:focus{
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 0 3px rgba(106,92,255,.20);
    transform:translateY(-1px);
  }

  .row{display:flex; gap:10px;}
  .row>div{flex:1}

  .btns{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:12px;
  }
  button{
    padding:10px 14px;          /* âœ… í¬ê¸° ì¤„ì„ */
    border-radius:12px;
    border:0;
    font-weight:900;
    cursor:pointer;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    color:#fff;
    box-shadow:0 8px 18px rgba(0,0,0,.25);
    transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
  }
  button:hover{transform:translateY(-2px); box-shadow:0 12px 26px rgba(0,0,0,.30);}
  button:active{transform:translateY(1px); filter:saturate(1.1);}

  .preview{
    margin-top:12px;
    padding:12px;
    border-radius:12px;
    background:rgba(255,255,255,.85);
    border:1px dashed rgba(0,0,0,.18);
    display:none;
    animation:fadeIn .35s ease;
  }
  @keyframes fadeIn{
    from{opacity:0;transform:scale(.985)}
    to{opacity:1;transform:scale(1)}
  }
  .preview img{
    max-width:210px;
    border-radius:10px;
    margin-top:8px;
    display:block;
  }
  .status{
    margin-top:10px;
    font-weight:900;
    font-size:13px;
  }

  /* ëª¨ë°”ì¼ì—ì„œ ì¤„ë°”ê¿ˆ */
  @media (max-width:560px){
    .row{flex-direction:column;}
  }
</style>
</head>

<body>
  <!-- ë°°ê²½ 2ì¥ìœ¼ë¡œ í¬ë¡œìŠ¤í˜ì´ë“œ -->
  <div id="bgA" class="bg on"></div>
  <div id="bgB" class="bg"></div>
  <div class="overlay"></div>
  <div class="grain"></div>

  <div class="wrap">
    <div class="card">
      <h1>ğŸ§ ìŒì•… ì¶”ì²œ ì œë³´</h1>
      <p class="muted">ë‹‰ë„¤ì„ + ë§í¬ + êµ¬ê°„ì„ ì…ë ¥í•˜ë©´ ìš´ì˜ì ë©”ì¼ë¡œ ì „ì†¡ë¼ìš”. (ë§í¬ ì…ë ¥í•˜ë©´ ìë™ ë¯¸ë¦¬ë³´ê¸°!)</p>

      <form id="form" action="https://formspree.io/f/mlggjprl" method="POST">
        <label>ë‹‰ë„¤ì„</label>
        <input name="nickname" placeholder="ì˜ˆ: PlayPod_K" required>

        <label>ìŒì•… ë§í¬</label>
        <input id="url" name="music_url" placeholder="YouTube / Spotify / SoundCloud ë§í¬" required>

        <div class="row">
          <div>
            <label>ì‹œì‘ ì‹œê°„</label>
            <input name="start_time" placeholder="ì˜ˆ: 1:12 ë˜ëŠ” 00:01:12" required>
          </div>
          <div>
            <label>ë ì‹œê°„</label>
            <input name="end_time" placeholder="ì˜ˆ: 1:45 ë˜ëŠ” 00:01:45" required>
          </div>
        </div>

        <label>ë©”ëª¨</label>
        <textarea name="note" placeholder="ì›í•˜ëŠ” ë¶„ìœ„ê¸°/í¬ì¸íŠ¸(ì„ íƒ)"></textarea>

        <div class="btns">
          <button type="button" id="previewBtn">ë¯¸ë¦¬ë³´ê¸°(ìˆ˜ë™)</button>
          <button type="submit">ì „ì†¡í•˜ê¸°</button>
        </div>

        <div id="preview" class="preview"></div>
        <div id="status" class="status"></div>

        <!-- ë©”ì¼ë¡œ ê°™ì´ ë³´ë‚´ëŠ” hidden -->
        <input type="hidden" id="meta_title" name="meta_title">
        <input type="hidden" id="meta_author" name="meta_author">
        <input type="hidden" id="meta_provider" name="meta_provider">
        <input type="hidden" id="meta_thumbnail" name="meta_thumbnail">
      </form>
    </div>
  </div>

<script>
  const $ = id => document.getElementById(id);

  function setStatus(msg, ok=true){
    $("status").textContent = msg || "";
    $("status").style.color = ok ? "#2b2b2b" : "crimson";
  }

  function detectProvider(url){
    try{
      const u = new URL(url);
      const h = u.hostname.toLowerCase();
      if (h.includes("youtube.com") || h.includes("youtu.be")) return "youtube";
      if (h.includes("open.spotify.com") || h.includes("spotify.link")) return "spotify";
      if (h.includes("soundcloud.com")) return "soundcloud";
      return "unknown";
    }catch(e){
      return "invalid";
    }
  }

  function oembedEndpoint(provider, url){
    const encoded = encodeURIComponent(url);
    if (provider === "youtube") return `https://www.youtube.com/oembed?url=${encoded}&format=json`;
    if (provider === "spotify") return `https://open.spotify.com/oembed?url=${encoded}`;
    if (provider === "soundcloud") return `https://soundcloud.com/oembed?format=json&url=${encoded}`;
    return null;
  }

  function clearMeta(){
    $("meta_title").value = "";
    $("meta_author").value = "";
    $("meta_provider").value = "";
    $("meta_thumbnail").value = "";
  }

  function renderPreview({ok, title, author_name, provider_name, thumbnail_url, error}){
    const box = $("preview");
    box.style.display = "block";

    if(!ok){
      box.innerHTML = `ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš” ğŸ˜¿<div style="margin-top:6px;color:rgba(0,0,0,.6);font-weight:600;font-size:13px">${error || ""}</div>`;
      clearMeta();
      return;
    }

    box.innerHTML = `
      <div style="font-weight:900;font-size:15px">${title || "(ì œëª© ì—†ìŒ)"}</div>
      <div style="color:rgba(0,0,0,.6);font-weight:650;font-size:13px;margin-top:2px">
        ${(provider_name||"")}${author_name ? " Â· " + author_name : ""}
      </div>
      ${thumbnail_url ? `<img src="${thumbnail_url}" alt="thumbnail">` : ""}
    `;

    $("meta_title").value = title || "";
    $("meta_author").value = author_name || "";
    $("meta_provider").value = provider_name || "";
    $("meta_thumbnail").value = thumbnail_url || "";
  }

  let lastPreviewUrl = "";
  let previewTimer = null;

  async function doPreview(auto=false){
    const url = $("url").value.trim();
    if(!url){
      $("preview").style.display = "none";
      setStatus("");
      clearMeta();
      lastPreviewUrl = "";
      return;
    }

    // ê°™ì€ URLë¡œ ë°˜ë³µ í˜¸ì¶œ ë°©ì§€
    if(url === lastPreviewUrl && auto) return;

    const provider = detectProvider(url);
    if(provider === "invalid"){
      setStatus("URL í˜•ì‹ì´ ì´ìƒí•´ìš” ğŸ˜¿", false);
      $("preview").style.display="none";
      clearMeta();
      return;
    }
    if(provider === "unknown"){
      renderPreview({ok:false, error:"ì§€ì›í•˜ì§€ ì•ŠëŠ” ë§í¬ì˜ˆìš”. (YouTube/Spotify/SoundCloud ê¶Œì¥)"});
      setStatus("ë¯¸ë¦¬ë³´ê¸° ì‹¤íŒ¨(ì§€ì› ë§í¬ ì•„ë‹˜) ğŸ˜¿", false);
      lastPreviewUrl = url;
      return;
    }

    const endpoint = oembedEndpoint(provider, url);
    setStatus("ë¯¸ë¦¬ë³´ê¸° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦");

    try{
      const res = await fetch(endpoint);
      if(!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();

      renderPreview({
        ok:true,
        title: data.title,
        author_name: data.author_name,
        provider_name: data.provider_name,
        thumbnail_url: data.thumbnail_url
      });

      setStatus("ë¯¸ë¦¬ë³´ê¸° ì™„ë£Œ! âœ…");
      lastPreviewUrl = url;
    }catch(e){
      renderPreview({ok:false, error:"oEmbed í˜¸ì¶œì´ ë§‰í˜”ê±°ë‚˜ ì‹¤íŒ¨í–ˆì–´ìš”(CORS/ë„¤íŠ¸ì›Œí¬). ê·¸ë˜ë„ ì „ì†¡ì€ ê°€ëŠ¥í•´ìš”!"});
      setStatus("ë¯¸ë¦¬ë³´ê¸° ì‹¤íŒ¨ ğŸ˜¿", false);
      lastPreviewUrl = url;
    }
  }

  function scheduleAutoPreview(){
    // íƒ€ì´í•‘ ë©ˆì¶˜ ë’¤ ìë™ ë¯¸ë¦¬ë³´ê¸° (ë””ë°”ìš´ìŠ¤)
    if(previewTimer) clearTimeout(previewTimer);
    previewTimer = setTimeout(() => doPreview(true), 550);
  }

  $("previewBtn").addEventListener("click", () => doPreview(false));
  $("url").addEventListener("input", scheduleAutoPreview);
  $("url").addEventListener("paste", scheduleAutoPreview);
  $("url").addEventListener("change", () => doPreview(true));
  $("url").addEventListener("blur", () => doPreview(true));

  // ì „ì†¡ ì„±ê³µ í­ì£½ (â€» Formspree ì‹¤ì œ ì„±ê³µ ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ í„°ì§ˆ ìˆ˜ ìˆìŒ. ì•„ë˜ "ì§„ì§œ ì„±ê³µ ì²˜ë¦¬" ë²„ì „ë„ ê°€ëŠ¥!)
  $("form").addEventListener("submit", () => {
    setTimeout(() => {
      confetti({ particleCount: 220, spread: 110, origin: { y: 0.65 } });
      setStatus("ì „ì†¡ ì™„ë£Œ! ğŸ‰ ì¶”ì²œ ê°ì‚¬í•©ë‹ˆë‹¤!", true);
    }, 350);
  });

  /* âœ… ë°°ê²½ì‚¬ì§„ ì‹¤ì‹œê°„ ë³€ê²½ (picsum ëœë¤ ì´ë¯¸ì§€, 12ì´ˆë§ˆë‹¤ í¬ë¡œìŠ¤í˜ì´ë“œ) */
  const bgA = $("bgA");
  const bgB = $("bgB");
  let bgOnA = true;
  let seed = Math.floor(Math.random()*100000);

  function bgUrl(s){
    // ì›í•˜ë©´ ì‚¬ì´ì¦ˆë¥¼ 1920/1080ë¡œ ì˜¬ë ¤ë„ ë¨
    return `https://picsum.photos/seed/${s}/1600/900`;
  }

  function setBackground(){
    seed += 1;
    const url = bgUrl(seed);

    const next = bgOnA ? bgB : bgA;
    const cur  = bgOnA ? bgA : bgB;

    next.style.backgroundImage = `url('${url}')`;
    next.classList.add("on");
    cur.classList.remove("on");

    bgOnA = !bgOnA;
  }

  // ì´ˆê¸° ë°°ê²½ 2ì¥ ì¤€ë¹„
  bgA.style.backgroundImage = `url('${bgUrl(seed)}')`;
  bgB.style.backgroundImage = `url('${bgUrl(seed+1)}')`;
  // ì²« ì „í™˜
  setTimeout(setBackground, 800);
  // ì£¼ê¸°ì ìœ¼ë¡œ ë³€ê²½
  setInterval(setBackground, 12000);
</script>
</body>
</html>
